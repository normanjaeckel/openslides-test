---
name: Test create, update and delete of tags

db:
  user:
    1:
      username: superadmin
      organisation_management_level: superadmin
  organisation:
    1:
      name: The one and only OpenSlides organisation
      committee_ids: 
      - 1
  committee:
    1: 
      organisation_id: 1
      name: Test committee
      meeting_ids:
      - 1
  meeting:
    1:
      committee_id: 1
      name: Test meeting

reset_db_between_tests: false

autoupdate:
  1: 
  - collection: meeting
    ids: [1]
    fields:
      tag_ids:
        type: relation-list
        collection: tag
        fields:
          name:

test_cases:
- name: Test creation of tag by superadmin
  request_user: 1
  test_case_url: /system/action
  payload:
  - action: tag.create
    data:
    - meeting_id: 1
      name: My first tag
  expected_http_response:
    status_code: 200
  expected_autoupdate:
  - meeting/1/tag_ids: [1]
    tag/1/name: My first tag

- name: Test update of tag by superadmin
  request_user: 1
  test_case_url: /system/action
  payload:
  - action: tag.update
    data:
    - id: 1
      name: My first tag with changed name
  expected_http_response:
    status_code: 200
  expected_autoupdate:
  - tag/1/name: My first tag with changed name

- name: Test deletion of tag by superadmin
  request_user: 1
  test_case_url: /system/action
  payload:
  - action: tag.delete
    data:
    - id: 1
  expected_http_response:
    status_code: 200
  expected_autoupdate:
  - meeting/1/tag_ids: []
    tag/1/name: null

- name: Test deleting of already deleted tag by superadmin
  request_user: 1
  test_case_url: /system/action
  payload:
  - action: tag.delete
    data:
    - id: 1
  expected_http_response:
    status_code: 400
